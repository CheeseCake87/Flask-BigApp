{% extends extend %}
{% import 'macros/forms/input.jinja' as input %}
{% import 'macros/forms/button.jinja' as button %}
{% import 'macros/forms/select.jinja' as select %}

{% block _title %}
    Administrator | Users
{% endblock %}

{% block _container %}
    <form method="post">
        <div class="action-box">
            <div class="form-container-inline">

                {{ input.input(
div=True,
type="text",
label="Username",
name="username",
class="input-small",
placeholder="",
required=True,
value="",
autocomplete=False,
read_only=False,
disabled=False
)|deco }}

                {% if "system" in session["permissions"] %}
                    {{ select.input_select_dict(label="Company", name="company", options=all_companies) }}
                {% endif %}

                {{ input.input(
div=True,
type="password",
label="Password",
name="password",
class="input-small",
placeholder="",
required=True,
value="",
autocomplete=False,
read_only=False,
disabled=False
)|deco }}

                {{ button.submit(name="add_user", value="Add User", class="button-100") }}

            </div>
        </div>
    </form>

    <table>
        <thead>
        <tr>
            <th>User ID</th>
            <th>Username</th>
            <th>Permissions</th>
            <th>Company</th>
            <th>Status</th>
            <th style="text-align: right">&nbsp;</th>
        </tr>
        </thead>
        <tbody>
        {% for user, values in all_users.items() %}
            <tr>
                <td>{{ user }}</td>
                <td>{{ values.username }}</td>
                <td>
                    {% for perm_name in values.permissions %}{{ perm_name }}<br/>{% endfor %}
                </td>
                <td>
                    {% for company_name in values.companies %}{{ company_name }}<br/>{% endfor %}
                </td>
                <td>
                    {% if values.disabled %}
                        Login Disabled
                    {% else %}
                        Login Enabled
                    {% endif %}
                </td>
                <td>
                    <div class="table-buttons">
                        {% set user_delete_show = "javascript:showEle('user_delete_" + user|string + "','table-row');" %}
                        {% set user_delete_hide = "javascript:hideEle('user_delete_" + user|string + "','table-row');" %}

                        {{ button.submit_link(
div=False,
name="edit_user",
label="Edit",
button_type="button button-small",
link=url_for('administrator.edit_user', user_id=user),
onclick="" ) }}

                        {{ button.submit_link(
div=False,
name="delete_user",
label="Delete",
button_type="button button-small button-danger",
link="",
onclick=user_delete_show ) }}
                    </div>
                </td>
            </tr>
            <tr id="user_delete_{{ user }}" style="display: none">
                <td colspan="100%">
                    <div class="table-row-action">
                        <div>Are you sure you want to delete this user?</div> &nbsp;
                        <div>
                            {{ button.submit_link(
div=False,
name="yes_delete_user",
label="Yes",
button_type="button button-small button-danger",
link=url_for("administrator.delete_user", user_id=user),
onclick="" ) }}
                        </div>
                        <div>
                            {{ button.submit_link(
div=False,
name="no_delete_user",
label="No",
button_type="button button-small",
link="",
onclick=user_delete_hide ) }}
                        </div>
                    </div>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block _footer %}

{% endblock %}